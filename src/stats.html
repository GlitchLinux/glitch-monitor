<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gLiTcH-SERVER Extended Statistics</title>
    <link rel="icon" href="https://glitchserver.com/glitch.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <style>
        .section-title {
            color: #32cd32;
            font-size: 1.2em;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .alert-box {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-weight: 500;
        }
        .alert-box.warning {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
            color: #ffa500;
        }
        .alert-box.danger {
            background: rgba(255, 69, 0, 0.2);
            border: 1px solid #ff4500;
            color: #ff4500;
        }
        .alert-box.ok {
            background: rgba(50, 205, 50, 0.2);
            border: 1px solid #32cd32;
            color: #32cd32;
        }
        .service-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        .service-name {
            font-family: 'Courier New', monospace;
            color: #d5d5d5;
        }
        .service-status {
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .service-status.active {
            background: rgba(50, 205, 50, 0.2);
            color: #32cd32;
        }
        .service-status.inactive {
            background: rgba(255, 69, 0, 0.2);
            color: #ff4500;
        }
        .ssl-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        .ssl-domain {
            font-family: 'Courier New', monospace;
            color: #d5d5d5;
        }
        .ssl-days {
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
        }
        .ssl-days.ok { background: rgba(50, 205, 50, 0.2); color: #32cd32; }
        .ssl-days.warning { background: rgba(255, 165, 0, 0.2); color: #ffa500; }
        .ssl-days.danger { background: rgba(255, 69, 0, 0.2); color: #ff4500; }
        .pre-block {
            background: #2a2a2a;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #aaa;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }
        .response-time {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        .response-time .domain { color: #d5d5d5; }
        .response-time .time { color: #32cd32; font-family: monospace; }
        .mini-stat {
            display: inline-block;
            background: #3a3a3a;
            padding: 4px 10px;
            border-radius: 4px;
            margin: 2px;
            font-size: 0.9em;
        }
        .mini-stat .label { color: #888; }
        .mini-stat .value { color: #32cd32; font-weight: bold; }
        .top-list {
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #aaa;
        }
        .top-list-item {
            padding: 4px 0;
            border-bottom: 1px solid #333;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="compact-header">
            <div class="header-content">
                <div class="header-main">
                    <div class="server-title">
                        <h1>üìä EXTENDED STATISTICS</h1>
                        <div class="status-indicator">
                            <span class="status-dot"></span>
                            <span class="status-text">Live Data</span>
                        </div>
                    </div>
                    <div class="header-buttons">
                        <a href="/dashboard.html" class="glow-btn"><span class="btn-icon">üè†</span> DASHBOARD</a>
                        <a href="/fail2ban.html" target="_blank" class="glow-btn"><span class="btn-icon">üõ°Ô∏è</span> FAIL2BAN</a>
                        <a href="/status-download.php" class="glow-btn"><span class="btn-icon">üì•</span> STATUS</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- System Alerts -->
        <div class="section-title">
            ‚ö†Ô∏è System Alerts
        </div>
        <div id="alerts-container" style="margin-bottom: 30px;">
            <div class="alert-box ok">‚úì System operating normally</div>
        </div>

        <!-- Apache Statistics -->
        <div class="section-title">
            üåê Apache Web Server
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üì°</span>
                    <h3>HTTP Connections</h3>
                </div>
                <div class="stat-value" id="apache-http">0</div>
                <div class="stat-details">Port 80</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üîí</span>
                    <h3>HTTPS Connections</h3>
                </div>
                <div class="stat-value" id="apache-https">0</div>
                <div class="stat-details">Port 443</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">‚öôÔ∏è</span>
                    <h3>Apache Processes</h3>
                </div>
                <div class="stat-value" id="apache-procs">0</div>
                <div class="stat-details">Worker processes</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üìä</span>
                    <h3>Requests Today</h3>
                </div>
                <div class="stat-value" id="apache-requests">0</div>
                <div class="stat-details">Total HTTP requests</div>
            </div>
        </div>

        <!-- Network Details -->
        <div class="section-title">
            üåê Network Details
        </div>
        <div style="background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
            <div style="margin-bottom: 15px;">
                <strong style="color: #32cd32;">Open Ports:</strong> <span id="open-ports">Loading...</span>
            </div>
            <div style="margin-bottom: 15px;">
                <strong style="color: #32cd32;">Established Connections:</strong> <span id="established-conns">0</span> |
                <strong style="color: #32cd32;">Time-Wait:</strong> <span id="timewait-conns">0</span>
            </div>
            <div style="margin-bottom: 15px;">
                <strong style="color: #32cd32;">Primary Interface:</strong> <span id="network-interface">eth0</span>
            </div>
            <div>
                <strong style="color: #32cd32;">Total Traffic:</strong>
                ‚Üì <span id="rx-traffic">0 GB</span> |
                ‚Üë <span id="tx-traffic">0 GB</span>
            </div>
        </div>

        <!-- Services Status -->
        <div class="section-title">
            üîß System Services
        </div>
        <div id="services-container" style="background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
            <div style="color: #888;">Loading services...</div>
        </div>

        <!-- SSL Certificates -->
        <div class="section-title">
            üîí SSL Certificates
        </div>
        <div id="ssl-container" style="background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
            <div style="color: #888;">Loading SSL data...</div>
        </div>

        <!-- Site Response Times -->
        <div class="section-title">
            ‚ö° Site Response Times
        </div>
        <div id="response-times-container" style="background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
            <div style="color: #888;">Loading response times...</div>
        </div>

        <!-- Storage Details -->
        <div class="section-title">
            üíæ Storage Details
        </div>
        <div style="background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
            <div style="margin-bottom: 15px;">
                <strong style="color: #32cd32;">Inode Usage:</strong> <span id="inode-usage">Loading...</span>
            </div>
            <div style="margin-bottom: 15px;">
                <strong style="color: #32cd32;">/var/www Size:</strong> <span id="www-size">Loading...</span>
            </div>
            <div>
                <strong style="color: #32cd32;">/var/log Size:</strong> <span id="log-size">Loading...</span>
            </div>
        </div>

        <!-- Security Summary -->
        <div class="section-title">
            üõ°Ô∏è Security Summary
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">‚ö†Ô∏è</span>
                    <h3>Failed SSH (24h)</h3>
                </div>
                <div class="stat-value" id="failed-total">0</div>
                <div class="stat-details">Total attempts</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üö´</span>
                    <h3>Banned IPs</h3>
                </div>
                <div class="stat-value" id="banned-count">0</div>
                <div class="stat-details">Currently blocked</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üë•</span>
                    <h3>Active Sessions</h3>
                </div>
                <div class="stat-value" id="active-sessions">0</div>
                <div class="stat-details">Logged in users</div>
            </div>
        </div>

        <footer>
            <div class="tech-stack">
                <span class="tech-badge" id="footer-os">üêß Linux</span>
                <span class="tech-badge">üåê Apache</span>
                <span class="tech-badge">üîí SSL/TLS</span>
                <span class="tech-badge">üìä Extended Stats</span>
            </div>
            <p class="footer-text">‚ú® Comprehensive Server Monitoring</p>
        </footer>
    </div>

    <script>
        async function fetchExtendedStats() {
            try {
                const response = await fetch('stats-extended.php');
                const data = await response.json();

                // Update Alerts
                const alertsContainer = document.getElementById('alerts-container');
                if (data.alerts && data.alerts.length > 0) {
                    alertsContainer.innerHTML = data.alerts.map(alert =>
                        `<div class="alert-box ${alert.type}">${alert.message}</div>`
                    ).join('');
                } else {
                    alertsContainer.innerHTML = '<div class="alert-box ok">‚úì System operating normally</div>';
                }

                // Update Apache Stats
                if (data.apache) {
                    document.getElementById('apache-http').textContent = data.apache.connections_http || 0;
                    document.getElementById('apache-https').textContent = data.apache.connections_https || 0;
                    document.getElementById('apache-procs').textContent = data.apache.processes || 0;
                    document.getElementById('apache-requests').textContent = data.apache.requests_today || 0;
                }

                // Update Network Details
                if (data.network) {
                    document.getElementById('open-ports').textContent = data.network.open_ports || 'N/A';
                    document.getElementById('established-conns').textContent = data.network.established || 0;
                    document.getElementById('timewait-conns').textContent = data.network.time_wait || 0;
                    document.getElementById('network-interface').textContent = data.network.interface || 'eth0';
                    document.getElementById('rx-traffic').textContent = data.network.rx_gb + ' GB' || '0 GB';
                    document.getElementById('tx-traffic').textContent = data.network.tx_gb + ' GB' || '0 GB';
                }

                // Update Services
                if (data.services && data.services.services) {
                    const servicesContainer = document.getElementById('services-container');
                    const servicesHtml = Object.entries(data.services.services).map(([name, info]) => {
                        const statusClass = info.active ? 'active' : 'inactive';
                        const statusText = info.status || (info.active ? 'active' : 'inactive');
                        return `<div class="service-row">
                            <span class="service-name">${name}</span>
                            <span class="service-status ${statusClass}">${statusText}</span>
                        </div>`;
                    }).join('');
                    servicesContainer.innerHTML = servicesHtml;
                }

                // Update SSL Certificates
                if (data.ssl) {
                    const sslContainer = document.getElementById('ssl-container');
                    const sslHtml = Object.entries(data.ssl).map(([domain, cert]) => {
                        let statusClass = 'ok';
                        if (cert.status === 'warning') statusClass = 'warning';
                        if (cert.status === 'danger') statusClass = 'danger';

                        const daysText = cert.days_left !== null ?
                            `${cert.days_left} days` : 'Unknown';

                        return `<div class="ssl-row">
                            <span class="ssl-domain">${domain}</span>
                            <span class="ssl-days ${statusClass}">${daysText}</span>
                        </div>`;
                    }).join('');
                    sslContainer.innerHTML = sslHtml;
                }

                // Update Response Times
                if (data.response_times) {
                    const timesContainer = document.getElementById('response-times-container');
                    const timesHtml = Object.entries(data.response_times).map(([domain, time]) =>
                        `<div class="response-time">
                            <span class="domain">${domain}</span>
                            <span class="time">${time}</span>
                        </div>`
                    ).join('');
                    timesContainer.innerHTML = timesHtml;
                }

                // Update Storage
                if (data.storage) {
                    document.getElementById('inode-usage').textContent = data.storage.inode_usage || 'N/A';
                    document.getElementById('www-size').textContent = data.storage.www_size || 'N/A';
                    document.getElementById('log-size').textContent = data.storage.log_size || 'N/A';
                }

                // Update Security Summary
                if (data.security) {
                    document.getElementById('failed-total').textContent = data.security.failed_total || 0;
                    document.getElementById('banned-count').textContent = data.security.banned_count || 0;
                    document.getElementById('active-sessions').textContent = data.security.active_sessions || 0;
                }

            } catch (error) {
                console.error('Error fetching extended stats:', error);
                const alertsContainer = document.getElementById('alerts-container');
                alertsContainer.innerHTML = '<div class="alert-box danger">‚ö†Ô∏è Error loading statistics</div>';
            }
        }

        // Fetch OS info for footer
        async function fetchOSInfo() {
            try {
                const response = await fetch('server-stats.php');
                const data = await response.json();
                if (data.system) {
                    document.getElementById('footer-os').textContent = 'üêß ' + data.system.os;
                }
            } catch (error) {
                console.error('Error fetching OS info:', error);
            }
        }

        // Initial load
        fetchExtendedStats();
        fetchOSInfo();

        // Auto-refresh every 15 seconds
        setInterval(fetchExtendedStats, 15000);
    </script>
</body>
</html>
