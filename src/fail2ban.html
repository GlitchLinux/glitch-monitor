<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gLiTcH-SERVER Fail2ban Monitor</title>
    <link rel="icon" href="https://glitchserver.com/glitch.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <style>
        .section-title {
            color: #32cd32;
            font-size: 1.2em;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .banned-ip {
            display: inline-block;
            background: #3a2020;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #ff4500;
            color: #ff4500;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .attacker-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-bottom: 1px solid #3a3a3a;
            font-family: 'Courier New', monospace;
        }
        .attacker-row:hover {
            background: #3a3a3a;
        }
        .attacker-ip { color: #ff6b6b; }
        .attacker-count { color: #32cd32; font-weight: bold; }
        .status-active {
            background: rgba(50, 205, 50, 0.2);
            color: #32cd32;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #32cd32;
            font-weight: bold;
        }
        .pre-block {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #aaa;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="compact-header">
            <div class="header-content">
                <div class="header-main">
                    <div class="server-title">
                        <h1>üõ°Ô∏è FAIL2BAN MONITOR</h1>
                        <div class="status-indicator">
                            <span class="status-dot"></span>
                            <span class="status-text" id="jail-status">Loading...</span>
                        </div>
                    </div>
                    <div class="header-buttons">
                        <a href="/dashboard.html" class="glow-btn"><span class="btn-icon">üè†</span> DASHBOARD</a>
                        <a href="/stats.html" target="_blank" class="glow-btn"><span class="btn-icon">üìä</span> STATISTICS</a>
                        <a href="/status-download.php" class="glow-btn"><span class="btn-icon">üì•</span> STATUS</a>
                    </div>
                </div>
            </div>
        </header>

        <div class="stats-grid">
            <!-- Currently Failed -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">‚ö†Ô∏è</span>
                    <h3>Currently Failed</h3>
                </div>
                <div class="stat-value" id="currently-failed">0</div>
                <div class="stat-details">Active failed attempts</div>
            </div>

            <!-- Total Failed -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üìä</span>
                    <h3>Total Failed</h3>
                </div>
                <div class="stat-value" id="total-failed">0</div>
                <div class="stat-details">All-time failed attempts</div>
            </div>

            <!-- Currently Banned -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üö´</span>
                    <h3>Currently Banned</h3>
                </div>
                <div class="stat-value" id="currently-banned">0</div>
                <div class="stat-details">Active bans</div>
            </div>

            <!-- Total Banned -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-icon">üîí</span>
                    <h3>Total Banned</h3>
                </div>
                <div class="stat-value" id="total-banned">0</div>
                <div class="stat-details">All-time bans</div>
            </div>
        </div>

        <div class="section-title">
            üö´ Currently Banned IPs
        </div>
        <div id="banned-ips-container" style="padding: 15px; background: #2a2a2a; border-radius: 8px; margin-bottom: 30px;">
            <div style="color: #888;">Loading...</div>
        </div>

        <div class="section-title">
            üîç Top Attackers (Last 24h)
        </div>
        <div id="top-attackers-container" style="background: #2a2a2a; border-radius: 8px; margin-bottom: 30px;">
            <div style="padding: 15px; color: #888;">Loading...</div>
        </div>

        <div class="section-title">
            ‚öôÔ∏è Jail Configuration
        </div>
        <div style="background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 30px;">
            <div style="margin-bottom: 10px;"><strong style="color: #32cd32;">Ban Duration:</strong> <span id="ban-duration">Loading...</span></div>
            <div><strong style="color: #32cd32;">Unique Attackers Today:</strong> <span id="unique-attackers">Loading...</span></div>
        </div>

        <footer>
            <div class="tech-stack">
                <span class="tech-badge">üõ°Ô∏è Fail2ban</span>
                <span class="tech-badge" id="footer-os">üêß Linux</span>
                <span class="tech-badge">üîí SSH Protection</span>
            </div>
            <p class="footer-text">‚ú® Real-time Security Monitoring</p>
        </footer>
    </div>

    <script>
        async function fetchFail2banData() {
            try {
                const response = await fetch('stats-extended.php');
                const data = await response.json();

                if (data.fail2ban) {
                    const f2b = data.fail2ban;

                    // Update stats
                    document.getElementById('currently-failed').textContent = f2b.currently_failed || 0;
                    document.getElementById('total-failed').textContent = f2b.total_failed || 0;
                    document.getElementById('currently-banned').textContent = f2b.currently_banned || 0;
                    document.getElementById('total-banned').textContent = f2b.total_banned || 0;

                    // Update jail status
                    const statusEl = document.getElementById('jail-status');
                    if (f2b.jail_status === 'active') {
                        statusEl.textContent = 'Active';
                        statusEl.className = 'status-text';
                    } else {
                        statusEl.textContent = 'Inactive';
                        statusEl.className = 'status-text';
                    }

                    // Display banned IPs
                    const bannedContainer = document.getElementById('banned-ips-container');
                    if (f2b.banned_ips && f2b.banned_ips.length > 0) {
                        bannedContainer.innerHTML = f2b.banned_ips.map(ip =>
                            `<span class="banned-ip">${ip}</span>`
                        ).join('');
                    } else {
                        bannedContainer.innerHTML = '<div style="color: #888; padding: 10px;">No IPs currently banned</div>';
                    }

                    // Display top attackers
                    const attackersContainer = document.getElementById('top-attackers-container');
                    if (f2b.top_attackers && f2b.top_attackers.trim() !== '') {
                        const attackers = f2b.top_attackers.trim().split('\n');
                        attackersContainer.innerHTML = attackers.map(line => {
                            const match = line.trim().match(/(\d+)\s+([\d.]+)/);
                            if (match) {
                                return `<div class="attacker-row">
                                    <span class="attacker-ip">${match[2]}</span>
                                    <span class="attacker-count">${match[1]} attempts</span>
                                </div>`;
                            }
                            return '';
                        }).join('');
                    } else {
                        attackersContainer.innerHTML = '<div style="padding: 15px; color: #888;">No attack data available</div>';
                    }

                    // Display config info
                    document.getElementById('ban-duration').textContent = f2b.ban_duration ?
                        (f2b.ban_duration / 60) + ' minutes' : 'N/A';
                    document.getElementById('unique-attackers').textContent = f2b.unique_attackers_today || 0;
                }
            } catch (error) {
                console.error('Error fetching fail2ban data:', error);
                document.getElementById('jail-status').textContent = 'Error loading data';
            }
        }

        // Fetch OS info for footer
        async function fetchOSInfo() {
            try {
                const response = await fetch('server-stats.php');
                const data = await response.json();
                if (data.system) {
                    document.getElementById('footer-os').textContent = 'üêß ' + data.system.os;
                }
            } catch (error) {
                console.error('Error fetching OS info:', error);
            }
        }

        // Initial load
        fetchFail2banData();
        fetchOSInfo();

        // Auto-refresh every 10 seconds
        setInterval(fetchFail2banData, 10000);
    </script>
</body>
</html>
